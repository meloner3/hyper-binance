# 持仓监控功能说明

## 📊 新增功能

### 1. 自动打印Hyperliquid持仓状态

程序现在会自动定期打印监控地址在Hyperliquid上的持仓信息。

### 2. 打印时机

- ✅ **启动时立即打印一次**：程序启动后会立即显示当前持仓状态
- ✅ **定期自动打印**：默认每5分钟（300秒）打印一次
- ✅ **可配置间隔**：可在 `config.py` 中修改 `POSITION_PRINT_INTERVAL` 参数

## 📋 显示内容

### 持仓信息
每个有持仓的币种会显示：
- 币种名称（如 BTC、ETH）
- 持仓方向（多头🟢 或 空头🔴）
- 持仓量
- 入场价格
- 持仓价值（USD）
- 杠杆倍数
- 已用保证金
- 未实现盈亏
- 强平价格

### 账户总览
- 账户总价值
- 已用保证金
- 可用余额

## 📝 输出示例

```
================================================================================
📊 查询地址 0xc2a30212a8ddac9e123944d6e29fadce994e5f2 的持仓状态
================================================================================

币种: BTC
  方向: 多头 🟢
  持仓量: 10.5
  入场价格: $113,875.90
  持仓价值: $1,195,696.95
  杠杆: 50x
  已用保证金: $23,913.94
  未实现盈亏: $12,450.50
  强平价格: $111,200.00

币种: ETH
  方向: 多头 🟢
  持仓量: 150.0
  入场价格: $4,125.30
  持仓价值: $618,795.00
  杠杆: 50x
  已用保证金: $12,375.90
  未实现盈亏: $5,230.20
  强平价格: $4,050.00

账户总览:
  账户价值: $50,234.56
  已用保证金: $36,289.84
  可用余额: $13,944.72
================================================================================
```

## ⚙️ 配置方法

### 修改打印间隔

编辑 `config.py` 文件：

```python
# 持仓打印间隔（秒）
POSITION_PRINT_INTERVAL = 300  # 默认300秒 = 5分钟

# 其他示例：
# POSITION_PRINT_INTERVAL = 60   # 1分钟
# POSITION_PRINT_INTERVAL = 600  # 10分钟
# POSITION_PRINT_INTERVAL = 1800 # 30分钟
```

## 🧪 测试功能

可以单独测试持仓查询功能：

```bash
python test_position.py
```

这会立即查询并显示当前持仓状态，无需等待。

## 📌 注意事项

1. **API限制**：Hyperliquid API有请求频率限制，建议打印间隔不要小于60秒
2. **网络延迟**：持仓信息可能有轻微延迟
3. **日志记录**：所有持仓信息都会记录到日志文件中
4. **无持仓显示**：如果监控地址没有持仓，会显示"当前无持仓"

## 🔍 监控逻辑

```
程序启动
    ↓
立即打印一次持仓
    ↓
开始监控循环
    ↓
每1秒扫描订单 ←─────┐
    ↓                │
检查是否到打印时间    │
    ↓                │
是：打印持仓          │
否：继续             │
    ↓                │
继续扫描 ────────────┘
```

## 💡 使用建议

1. **初次运行**：先运行 `test_position.py` 确认能正常获取持仓信息
2. **调整间隔**：根据实际需求调整打印间隔
3. **查看日志**：定期查看 `trading_monitor.log` 了解持仓变化
4. **监控重要时刻**：在预期有大额交易时，可以临时缩短打印间隔

## 🚀 实际应用场景

### 场景1：日常监控
- 打印间隔：5-10分钟
- 目的：了解监控地址的持仓状态和变化

### 场景2：重点关注
- 打印间隔：1-2分钟
- 目的：密切关注可能的平仓操作

### 场景3：事件驱动
- 打印间隔：5分钟（默认）
- 检测到平仓后会自动触发交易
- 交易后会显示最新持仓

## 📊 与交易逻辑的配合

```
监控持仓（每5分钟）
    ↓
发现大额多单
    ↓
持续监控订单（每1秒）
    ↓
检测到平多仓
    ↓
触发币安开空
    ↓
显示币安持仓
```

这样可以全面了解：
1. Hyperliquid监控地址的持仓状态
2. 何时触发了平仓操作
3. 币安跟单的执行情况

