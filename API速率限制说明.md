# Hyperliquid API 速率限制说明

## 📌 官方信息

**重要**：Hyperliquid官方未公开具体的API速率限制文档。

根据实践经验和社区反馈：
- ⚠️ API存在速率限制，但具体数值未公开
- ⚠️ 曾因流量激增导致API短暂中断
- 💡 建议采用保守的请求频率

## 🛡️ 本项目的保护措施

### 1. 内置速率限制
```python
API_REQUEST_DELAY = 0.2  # 每次请求间隔至少0.2秒
```
这意味着：
- 每秒最多发送 **5次** API请求
- 自动在请求之间添加延迟
- 防止触发潜在的速率限制

### 2. 错误处理
- ✅ 检测 HTTP 429 状态码（速率限制）
- ✅ 自动等待5秒后重试
- ✅ 记录错误次数和警告信息

### 3. 请求统计
- `api_request_count`: 总请求次数
- `api_error_count`: 错误次数
- 便于监控和调试

## 📊 当前配置分析

### 默认配置
```python
SCAN_INTERVAL = 1  # 每秒1次订单扫描
POSITION_PRINT_INTERVAL = 300  # 每5分钟1次持仓查询
```

### 实际请求频率
| 接口 | 频率 | 每秒请求数 | 状态 |
|------|------|-----------|------|
| userFills | 每1秒 | 1.0 | ✅ 安全 |
| clearinghouseState | 每300秒 | 0.003 | ✅ 安全 |
| **总计** | - | **~1.003** | ✅ 非常安全 |

## ⚙️ 配置建议

### 推荐配置（当前）✅
```python
SCAN_INTERVAL = 1
POSITION_PRINT_INTERVAL = 300
```
- 平衡性好
- 不会触发限制
- 能及时检测平仓操作

### 保守配置
```python
SCAN_INTERVAL = 2  # 每2秒扫描一次
POSITION_PRINT_INTERVAL = 600  # 每10分钟打印持仓
```
- 更加保守
- 适合长期稳定运行
- 降低API服务器压力

### 激进配置（不推荐）⚠️
```python
SCAN_INTERVAL = 0.5  # 每0.5秒扫描一次
POSITION_PRINT_INTERVAL = 60  # 每1分钟打印持仓
```
- 每秒约2.016次请求
- 可能接近速率限制
- 不建议长期使用

## 🚨 速率限制触发时的表现

### 日志输出
```
⚠️ API速率限制！已触发 1 次
```

### 自动处理
1. 程序检测到429状态码
2. 自动等待5秒
3. 继续正常运行
4. 记录错误次数

### 建议操作
如果频繁看到此警告：
1. 增加 `SCAN_INTERVAL`（如改为2秒）
2. 增加 `POSITION_PRINT_INTERVAL`（如改为600秒）
3. 检查是否有其他程序也在使用同一API

## 📈 监控建议

### 查看API统计
在程序运行时，可以通过日志查看：
- 总请求次数
- 错误次数
- 速率限制触发次数

### 日志示例
```
2025-10-28 12:00:00 - DEBUG - 速率限制：等待 0.15 秒
2025-10-28 12:00:01 - DEBUG - 成功获取订单数据: 150条
2025-10-28 12:05:00 - INFO - 📊 查询地址持仓状态
```

## 💡 优化建议

### 1. 根据实际需求调整
- 如果监控地址交易不频繁，可以增加扫描间隔
- 如果只关注大额平仓，可以减少持仓打印频率

### 2. 错误监控
定期检查日志中的错误计数：
```bash
grep "API速率限制" trading_monitor.log
```

### 3. 网络优化
- 使用稳定的网络连接
- 考虑使用代理或CDN
- 避免在网络高峰期运行

## 🔧 高级配置

### 修改速率限制参数
如果需要更保守的设置，可以修改 `hyperliquid_monitor.py`：

```python
# 更保守的设置
API_REQUEST_DELAY = 0.5  # 每次请求间隔0.5秒（每秒最多2次）

# 或更激进的设置（不推荐）
API_REQUEST_DELAY = 0.1  # 每次请求间隔0.1秒（每秒最多10次）
```

### 动态调整
未来可以考虑实现：
- 根据错误率动态调整请求频率
- 指数退避策略
- 请求队列管理

## 📚 参考信息

### Hyperliquid API文档
- 官方文档：https://hyperliquid.gitbook.io/hyperliquid-docs/
- API端点：https://api.hyperliquid.xyz/info

### 社区反馈
- Hyperliquid曾因流量激增导致API中断
- 社区建议保守使用API
- 建议实现重试机制和错误处理

## ⚠️ 重要提示

1. **官方未公布具体限制**：以上建议基于保守估计
2. **可能随时变化**：Hyperliquid可能调整速率限制策略
3. **监控运行状态**：定期检查日志，确保程序正常运行
4. **联系官方**：如需确切信息，建议联系Hyperliquid官方支持

## 📞 获取帮助

如果遇到速率限制问题：
1. 检查日志文件中的错误信息
2. 尝试增加请求间隔
3. 联系Hyperliquid官方支持
4. 在社区寻求帮助

---

**最后更新**：2025-10-28  
**当前配置**：安全且稳定 ✅

