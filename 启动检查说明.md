# 启动检查功能说明

## 📋 功能概述

程序启动时会自动执行以下检查，确保所有API接口正常工作：

1. ✅ **测试订单接口** - 获取并显示最近一笔订单
2. ✅ **查询持仓状态** - 显示当前持仓信息
3. ✅ **开始监控** - 启动持续监控

## 🔍 启动检查流程

### 1. API接口测试

程序会调用 `userFills` 接口获取最近一笔订单：

```
================================================================================
🔍 测试API接口 - 获取最近一笔订单记录
================================================================================
✅ API接口正常！

最近一笔订单:
  时间: 2025-10-28 12:45:30
  币种: BTC
  方向: 卖出
  数量: 0.5
  价格: 113875.9
  已实现盈亏: 1250.50

总订单数: 150 条
================================================================================
```

### 2. 持仓状态查询

显示监控地址的当前持仓：

```
================================================================================
📊 查询地址 0xc2a30212a8ddac9e123944d6e29fadce994e5f2 的持仓状态
================================================================================

币种: BTC
  方向: 多头 🟢
  持仓量: 10.5
  入场价格: $113,875.90
  持仓价值: $1,195,696.95
  杠杆: 50x
  已用保证金: $23,913.94
  未实现盈亏: $12,450.50
  强平价格: $111,200.00

账户总览:
  账户价值: $50,234.56
  已用保证金: $36,289.84
  可用余额: $13,944.72
================================================================================
```

### 3. 开始监控

```
🚀 开始监控...
按 Ctrl+C 停止监控
```

## ✅ 成功启动示例

完整的启动日志：

```
2025-10-28 13:00:00 - root - INFO - ============================================================
2025-10-28 13:00:00 - root - INFO - 日志系统初始化完成 - 2025-10-28 13:00:00
2025-10-28 13:00:00 - root - INFO - ============================================================
2025-10-28 13:00:00 - __main__ - INFO - 初始化Hyperliquid监控器...
2025-10-28 13:00:00 - __main__ - INFO - 初始化币安交易客户端...
2025-10-28 13:00:01 - binance_trader - INFO - 使用币安正式网
2025-10-28 13:00:01 - binance_trader - INFO - 币安API连接成功
2025-10-28 13:00:01 - __main__ - INFO - ✅ 交易机器人初始化完成

2025-10-28 13:00:01 - __main__ - INFO - ================================================================================
2025-10-28 13:00:01 - __main__ - INFO - 🤖 Hyperliquid监控交易机器人
2025-10-28 13:00:01 - __main__ - INFO - ================================================================================
2025-10-28 13:00:01 - __main__ - INFO - 监控地址: 0xc2a30212a8ddac9e123944d6e29fadce994e5f2
2025-10-28 13:00:01 - __main__ - INFO - 扫描间隔: 1秒
2025-10-28 13:00:01 - __main__ - INFO - 杠杆倍数: 100x
2025-10-28 13:00:01 - __main__ - INFO - 持仓量: 1000 USDC
2025-10-28 13:00:01 - __main__ - INFO - 交易对: ETH→ETHUSDC, BTC→BTCUSDC
2025-10-28 13:00:01 - __main__ - INFO - 测试模式: 否
2025-10-28 13:00:01 - __main__ - INFO - ================================================================================

2025-10-28 13:00:01 - hyperliquid_monitor - INFO - 开始监控地址: 0xc2a30212a8ddac9e123944d6e29fadce994e5f2, 扫描间隔: 1秒
2025-10-28 13:00:01 - hyperliquid_monitor - INFO - 持仓状态打印间隔: 300秒 (5分钟)

2025-10-28 13:00:01 - hyperliquid_monitor - INFO - ================================================================================
2025-10-28 13:00:01 - hyperliquid_monitor - INFO - 🔍 测试API接口 - 获取最近一笔订单记录
2025-10-28 13:00:01 - hyperliquid_monitor - INFO - ================================================================================
2025-10-28 13:00:02 - hyperliquid_monitor - INFO - ✅ API接口正常！
2025-10-28 13:00:02 - hyperliquid_monitor - INFO - 
最近一笔订单:
  时间: 2025-10-28 12:45:30
  币种: BTC
  方向: 卖出
  数量: 0.5
  价格: 113875.9
  已实现盈亏: 1250.50

总订单数: 150 条
2025-10-28 13:00:02 - hyperliquid_monitor - INFO - ================================================================================

2025-10-28 13:00:02 - hyperliquid_monitor - INFO - ================================================================================
2025-10-28 13:00:02 - hyperliquid_monitor - INFO - 📊 查询地址 0xc2a30212a8ddac9e123944d6e29fadce994e5f2 的持仓状态
2025-10-28 13:00:02 - hyperliquid_monitor - INFO - ================================================================================
[持仓信息...]

2025-10-28 13:00:03 - __main__ - INFO - 🚀 开始监控...
2025-10-28 13:00:03 - __main__ - INFO - 按 Ctrl+C 停止监控
```

## ❌ 异常情况处理

### 情况1：无法获取订单数据

```
================================================================================
🔍 测试API接口 - 获取最近一笔订单记录
================================================================================
❌ 无法获取订单数据，API接口可能异常
⚠️  API接口测试失败，但程序将继续运行
```

**原因**：
- 网络连接问题
- API服务器暂时不可用
- 速率限制

**处理**：程序会继续运行，但建议检查网络和API状态

### 情况2：该地址无订单记录

```
================================================================================
🔍 测试API接口 - 获取最近一笔订单记录
================================================================================
⚠️  该地址暂无订单记录
================================================================================
```

**原因**：监控地址从未进行过交易

**处理**：这是正常情况，程序会继续运行

### 情况3：无法获取持仓信息

```
================================================================================
📊 查询地址 0xc2a30212a8ddac9e123944d6e29fadce994e5f2 的持仓状态
================================================================================
⚠️  无法获取持仓信息
================================================================================
```

**原因**：API接口暂时不可用

**处理**：程序会继续运行，下次定期查询时会重试

## 🧪 独立测试脚本

### 测试订单接口

```bash
python test_fills.py
```

快速测试 `userFills` 接口是否正常，显示最近一笔订单。

### 测试持仓查询

```bash
python test_position.py
```

同时测试订单接口和持仓查询接口。

### 测试下单功能

```bash
python test_order.py
```

测试币安交易功能（会执行真实交易）。

## 💡 使用建议

### 1. 首次运行

在首次运行主程序前，建议先运行测试脚本：

```bash
# 1. 测试订单接口
python test_fills.py

# 2. 测试持仓查询
python test_position.py

# 3. 确认无误后启动主程序
python main.py
```

### 2. 日常监控

正常启动主程序即可，程序会自动执行所有检查：

```bash
python main.py
```

### 3. 故障排查

如果启动时发现异常：

1. 检查网络连接
2. 运行独立测试脚本定位问题
3. 查看日志文件了解详细错误信息
4. 检查API速率限制是否触发

## 📊 启动检查的意义

### 1. 验证API可用性
- 确保Hyperliquid API正常工作
- 确认监控地址有效
- 验证网络连接正常

### 2. 了解当前状态
- 查看监控地址的最新交易
- 了解当前持仓情况
- 评估账户风险

### 3. 及早发现问题
- 在开始监控前发现配置错误
- 避免长时间运行后才发现问题
- 提高系统可靠性

## 🔧 自定义检查

如果需要修改启动检查行为，可以编辑 `hyperliquid_monitor.py` 中的 `start_monitoring` 方法：

```python
def start_monitoring(self, scan_interval: int, callback, position_print_interval: int = 300):
    # 1. 测试API接口
    if not self.print_latest_fill():
        logger.error("⚠️  API接口测试失败，但程序将继续运行")
    
    # 2. 打印持仓状态
    self.print_positions()
    
    # 3. 开始监控循环
    while True:
        ...
```

## 📝 日志记录

所有启动检查信息都会记录到日志文件中：
- 控制台输出：INFO级别及以上
- 日志文件：DEBUG级别及以上

查看日志：
```bash
tail -f trading_monitor.log
```

## ⚠️ 注意事项

1. **启动时间**：启动检查会增加2-3秒的启动时间
2. **API请求**：启动时会发送2次API请求（订单+持仓）
3. **失败处理**：即使检查失败，程序也会继续运行
4. **网络依赖**：需要稳定的网络连接

## 🎯 预期效果

正常启动后，您应该看到：
- ✅ API接口正常
- ✅ 显示最近订单信息
- ✅ 显示当前持仓状态
- ✅ 开始监控循环

这表明所有系统正常，可以放心运行！

